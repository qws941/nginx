<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에어갭 환경 통합 설치 패키지 v1.0 - 운영 매뉴얼</title>
    <style>
        @media print {
            .no-print { display: none; }
            body { font-size: 12pt; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            line-height: 1.8;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            padding-bottom: 20px;
            border-bottom: 4px solid #3498db;
        }

        h2 {
            color: #34495e;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            padding: 10px 0;
            border-bottom: 2px solid #e0e0e0;
        }

        h3 {
            color: #555;
            font-size: 1.4em;
            margin: 30px 0 15px 0;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .error-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95em;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background: #34495e;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }

        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 5px;
        }

        .badge-success {
            background: #4caf50;
            color: white;
        }

        .badge-info {
            background: #2196f3;
            color: white;
        }

        .badge-warning {
            background: #ff9800;
            color: white;
        }

        .badge-star {
            background: #ffd700;
            color: #333;
        }

        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin: 30px 0;
        }

        .toc h2 {
            margin-top: 0;
            border-bottom: none;
        }

        .toc ul {
            margin-left: 20px;
        }

        .toc a {
            color: #2c3e50;
            text-decoration: none;
        }

        .toc a:hover {
            color: #3498db;
            text-decoration: underline;
        }

        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .print-btn:hover {
            background: #2980b9;
        }

        .footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
            color: #777;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <button class="print-btn no-print" onclick="window.print()">🖨️ 인쇄</button>

    <div class="container">
        <h1>🚀 에어갭 환경 통합 설치 패키지</h1>

        <div class="info-box">
            <strong>완전 오프라인 설치 패키지</strong> - 인터넷 연결 없이 Windows Server에 Node.js + Nginx 리버스 프록시 시스템 구축
        </div>

        <table>
            <tr>
                <th>항목</th>
                <th>내용</th>
            </tr>
            <tr>
                <td><strong>생성 일시</strong></td>
                <td>2025-10-20</td>
            </tr>
            <tr>
                <td><strong>패키지 크기</strong></td>
                <td>132MB (Zoraxy 포함)</td>
            </tr>
            <tr>
                <td><strong>패키지 버전</strong></td>
                <td>1.0.0</td>
            </tr>
            <tr>
                <td><strong>대상 환경</strong></td>
                <td>Windows Server 2016/2019/2022 (에어갭)</td>
            </tr>
            <tr>
                <td><strong>문법 검사</strong></td>
                <td><span class="badge badge-success">✅ 통과</span> (A+ 등급)</td>
            </tr>
        </table>

        <!-- 목차 -->
        <div class="toc">
            <h2>📑 목차</h2>
            <ul>
                <li><a href="#components">포함된 구성요소</a></li>
                <li><a href="#quickstart">빠른 설치 (3단계)</a></li>
                <li><a href="#structure">패키지 구조</a></li>
                <li><a href="#proxy-options">프록시 관리 옵션</a></li>
                <li><a href="#verification">설치 검증</a></li>
                <li><a href="#troubleshooting">문제 해결</a></li>
                <li><a href="#operations">운영 가이드</a></li>
            </ul>
        </div>

        <!-- 구성요소 -->
        <h2 id="components">✅ 포함된 구성요소</h2>

        <table>
            <tr>
                <th>구성요소</th>
                <th>버전</th>
                <th>크기</th>
                <th>용도</th>
            </tr>
            <tr>
                <td><strong>Node.js</strong></td>
                <td>v20.11.0</td>
                <td>26MB</td>
                <td>JavaScript 런타임</td>
            </tr>
            <tr>
                <td><strong>Nginx</strong></td>
                <td>v1.24.0</td>
                <td>1.7MB</td>
                <td>리버스 프록시 웹서버</td>
            </tr>
            <tr>
                <td><strong>Zoraxy</strong> <span class="badge badge-info">NEW</span></td>
                <td>latest</td>
                <td>80MB</td>
                <td>웹 UI 프록시 관리자 (옵션)</td>
            </tr>
            <tr>
                <td><strong>NSSM</strong></td>
                <td>v2.24</td>
                <td>344KB</td>
                <td>Windows 서비스 관리자</td>
            </tr>
            <tr>
                <td><strong>Visual C++</strong></td>
                <td>2022</td>
                <td>25MB</td>
                <td>런타임 라이브러리</td>
            </tr>
        </table>

        <div class="success-box">
            <strong>✅ 모든 파일의 SHA256 체크섬이 포함되어 있습니다.</strong>
        </div>

        <!-- 프록시 관리 옵션 -->
        <h3>🎯 프록시 관리 옵션 3가지</h3>

        <table>
            <tr>
                <th>옵션</th>
                <th>기존 설정 유지</th>
                <th>웹 UI</th>
                <th>권장 대상</th>
            </tr>
            <tr>
                <td><strong>1. PowerShell 스크립트</strong></td>
                <td>✅</td>
                <td>❌</td>
                <td>PowerShell 익숙한 사용자</td>
            </tr>
            <tr>
                <td><strong>2. Node.js 웹 UI</strong> <span class="badge badge-star">⭐ 권장</span></td>
                <td>✅</td>
                <td>✅</td>
                <td>웹 UI 원하는 사용자</td>
            </tr>
            <tr>
                <td><strong>3. Zoraxy</strong></td>
                <td>❌</td>
                <td>✅</td>
                <td>완전히 새로 시작</td>
            </tr>
        </table>

        <!-- 빠른 설치 -->
        <h2 id="quickstart">🔥 빠른 설치 (3단계)</h2>

        <h3>1️⃣ 패키지 전송</h3>
        <pre><code># USB 또는 내부 네트워크로 전송
# 전체 airgap-package 폴더를 Windows Server로 복사</code></pre>

        <h3>2️⃣ 설치 실행</h3>
        <pre><code># Windows Server에서 관리자 PowerShell 실행
cd airgap-package\scripts
.\02-install-airgap.ps1

# 자동으로 설치됩니다:
# ✓ Visual C++ 재배포 패키지
# ✓ Node.js v20.11.0
# ✓ Nginx v1.24.0
# ✓ NSSM 서비스 관리자
# ✓ Zoraxy 프록시 관리자
# ✓ DNS 서버 (선택)
# ✓ 방화벽 규칙</code></pre>

        <h3>3️⃣ 검증</h3>
        <pre><code>.\03-verify-installation.ps1

# 설치 확인
node --version
npm --version</code></pre>

        <!-- 패키지 구조 -->
        <h2 id="structure">📂 패키지 구조</h2>

        <pre><code>airgap-package/
├── installers/                     # 설치 파일 (131MB)
│   ├── node-v20.11.0-x64.msi      # Node.js 설치 파일
│   ├── nginx-1.24.0.zip           # Nginx 웹서버
│   ├── zoraxy_windows_amd64.exe   # Zoraxy 프록시 관리자
│   ├── nssm-2.24.zip              # NSSM 서비스 관리자
│   └── vcredist_x64.exe           # Visual C++ 재배포
├── scripts/                        # 설치 스크립트
│   ├── 01-prepare-airgap.ps1      # 패키지 수집
│   ├── 02-install-airgap.ps1      # ★ 메인 설치 스크립트
│   ├── 03-verify-installation.ps1 # 설치 검증
│   ├── download-packages.sh        # [Linux] 패키지 수집
│   └── nginx-web-ui.js            # Node.js 웹 UI
├── configs/                        # 설정 템플릿
│   └── services.csv.example       # 서비스 목록 예제
├── ssl/                            # SSL 인증서 (수동 추가)
├── logs/                           # 설치 로그
├── checksums.txt                   # ★ 파일 무결성 체크섬
└── README.md                       # 문서</code></pre>

        <!-- 프록시 관리 옵션 상세 -->
        <h2 id="proxy-options">🎯 프록시 관리 옵션 상세</h2>

        <h3>옵션 2: Node.js 웹 UI <span class="badge badge-star">⭐ 권장</span></h3>

        <div class="info-box">
            <strong>기존 conf.d 설정을 그대로 사용하면서 웹 UI로 관리</strong>
        </div>

        <pre><code># 웹 UI 시작
cd C:\airgap-package\scripts
node nginx-web-ui.js

# 브라우저 접속
# http://localhost:8080</code></pre>

        <h4>주요 기능:</h4>
        <ul>
            <li>✅ 기존 conf.d/*.conf 파일 자동 인식</li>
            <li>✅ 웹 UI에서 프록시 추가/삭제</li>
            <li>✅ Nginx 실시간 재로드</li>
            <li>✅ 상태 모니터링 (5초마다)</li>
            <li>✅ SSL 배지 표시</li>
        </ul>

        <h4>서비스 등록 (자동 시작):</h4>
        <pre><code>cd C:\nginx
.\nssm.exe install nginx-web-ui "C:\Program Files\nodejs\node.exe"
.\nssm.exe set nginx-web-ui AppParameters "C:\airgap-package\scripts\nginx-web-ui.js"
.\nssm.exe set nginx-web-ui AppDirectory "C:\airgap-package\scripts"
.\nssm.exe set nginx-web-ui DisplayName "Nginx Web UI"
.\nssm.exe set nginx-web-ui Start SERVICE_AUTO_START

Start-Service nginx-web-ui</code></pre>

        <!-- 설치 검증 -->
        <h2 id="verification">🔍 설치 검증</h2>

        <pre><code># 기본 검증
.\03-verify-installation.ps1

# 상세 모드
.\03-verify-installation.ps1 -Detailed

# 보고서 내보내기
.\03-verify-installation.ps1 -ExportReport</code></pre>

        <h3>검증 항목 (8개 카테고리)</h3>
        <ol>
            <li>✓ Node.js 및 npm 버전</li>
            <li>✓ Nginx 설정 파일 및 구문</li>
            <li>✓ NSSM 서비스 관리자</li>
            <li>✓ DNS 서버 상태</li>
            <li>✓ 방화벽 규칙</li>
            <li>✓ SSL 인증서</li>
            <li>✓ 환경변수 (PATH)</li>
            <li>✓ 포트 가용성 (80, 443, 3000, 8080)</li>
        </ol>

        <!-- 문제 해결 -->
        <h2 id="troubleshooting">⚠️ 문제 해결</h2>

        <h3>Node.js 명령어를 찾을 수 없음</h3>
        <pre><code># 환경변수 수동 설정
$env:Path += ";C:\Program Files\nodejs"
[Environment]::SetEnvironmentVariable("Path", $env:Path, "Machine")

# PowerShell 재시작 필수</code></pre>

        <h3>Nginx 서비스 시작 실패</h3>
        <pre><code># 로그 확인
Get-Content C:\nginx\logs\error.log -Tail 20

# 설정 파일 테스트
C:\nginx\nginx.exe -t

# 포트 충돌 확인
Get-NetTCPConnection -LocalPort 80,443</code></pre>

        <h3>SSL 인증서 오류</h3>
        <pre><code># 인증서 파일 권한 확인
icacls C:\nginx\conf\ssl\cert.key

# PEM 형식 확인
Get-Content C:\nginx\conf\ssl\cert.crt | Select-Object -First 1</code></pre>

        <!-- 운영 가이드 -->
        <h2 id="operations">📋 운영 가이드</h2>

        <h3>일일 점검 체크리스트</h3>
        <table>
            <tr>
                <th>항목</th>
                <th>명령어</th>
                <th>정상 상태</th>
            </tr>
            <tr>
                <td><strong>Nginx 서비스</strong></td>
                <td><code>Get-Service nginx</code></td>
                <td>Running</td>
            </tr>
            <tr>
                <td><strong>웹 UI 서비스</strong></td>
                <td><code>Get-Service nginx-web-ui</code></td>
                <td>Running</td>
            </tr>
            <tr>
                <td><strong>디스크 공간</strong></td>
                <td><code>Get-PSDrive C</code></td>
                <td>&gt; 10GB 여유</td>
            </tr>
            <tr>
                <td><strong>로그 크기</strong></td>
                <td><code>Get-ChildItem C:\nginx\logs -Recurse</code></td>
                <td>&lt; 1GB</td>
            </tr>
        </table>

        <h3>주간 점검 체크리스트</h3>
        <ul>
            <li>✓ SSL 인증서 만료일 확인 (30일 이내)</li>
            <li>✓ Windows 업데이트 확인</li>
            <li>✓ 로그 파일 백업 및 정리</li>
            <li>✓ 프록시 설정 백업</li>
        </ul>

        <h3>로그 관리</h3>
        <pre><code># 7일 이상 된 로그 삭제
Get-ChildItem C:\nginx\logs\*.log |
    Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-7)} |
    Remove-Item

# 로그 아카이브
Compress-Archive -Path C:\nginx\logs\*.log -DestinationPath "C:\backup\nginx-logs-$(Get-Date -Format yyyyMMdd).zip"</code></pre>

        <h3>백업 절차</h3>
        <pre><code># 설정 파일 백업
$backupDate = Get-Date -Format "yyyyMMdd-HHmmss"
$backupPath = "C:\backup\nginx-config-$backupDate"

# Nginx 설정
Copy-Item -Recurse C:\nginx\conf $backupPath\conf

# 프록시 설정 (conf.d)
Copy-Item -Recurse C:\nginx\conf\conf.d $backupPath\conf.d

# 서비스 목록
Copy-Item C:\nginx\services.csv $backupPath\services.csv

# 압축
Compress-Archive -Path $backupPath -DestinationPath "$backupPath.zip"</code></pre>

        <!-- 보안 검증 -->
        <h2>🔒 보안 검증</h2>

        <h3>체크섬 확인</h3>
        <table>
            <tr>
                <th>파일명</th>
                <th>SHA256 체크섬</th>
            </tr>
            <tr>
                <td>node-v20.11.0-x64.msi</td>
                <td><code>9a8c2e99b1fca559e1a1a393d6be4a23781b0c66883a9d6e5584272d9bf49dc2</code></td>
            </tr>
            <tr>
                <td>nginx-1.24.0.zip</td>
                <td><code>69a36bfd2a61d7a736fafd392708bd0fb6cf15d741f8028fe6d8bb5ebd670eb9</code></td>
            </tr>
            <tr>
                <td>nssm-2.24.zip</td>
                <td><code>727d1e42275c605e0f04aba98095c38a8e1e46def453cdffce42869428aa6743</code></td>
            </tr>
            <tr>
                <td>vcredist_x64.exe</td>
                <td><code>cc0ff0eb1dc3f5188ae6300faef32bf5beeba4bdd6e8e445a9184072096b713b</code></td>
            </tr>
            <tr>
                <td>zoraxy_windows_amd64.exe</td>
                <td><code>6aea6329574559decb54cbd5b4481be06e260e99fcf0427caf83e0239841a374</code></td>
            </tr>
        </table>

        <!-- 시스템 요구사항 -->
        <h2>📊 시스템 요구사항</h2>

        <table>
            <tr>
                <th>항목</th>
                <th>요구사항</th>
            </tr>
            <tr>
                <td><strong>운영체제</strong></td>
                <td>Windows Server 2016/2019/2022</td>
            </tr>
            <tr>
                <td><strong>PowerShell</strong></td>
                <td>5.1 이상</td>
            </tr>
            <tr>
                <td><strong>디스크 공간</strong></td>
                <td>최소 10GB 여유</td>
            </tr>
            <tr>
                <td><strong>메모리</strong></td>
                <td>최소 4GB RAM</td>
            </tr>
            <tr>
                <td><strong>권한</strong></td>
                <td>관리자 권한 필수</td>
            </tr>
            <tr>
                <td><strong>네트워크</strong></td>
                <td>인터넷 불필요 (오프라인 설치)</td>
            </tr>
        </table>

        <!-- Footer -->
        <div class="footer">
            <p><strong>패키지 버전:</strong> 1.0.0</p>
            <p><strong>최종 업데이트:</strong> 2025-10-20</p>
            <p><strong>문법 검사:</strong> <span class="badge badge-success">✅ A+ (95/100)</span></p>
            <p><strong>Package Hash:</strong> SHA256 verified</p>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
            <p style="margin-top: 20px;"><strong>Happy Coding! 🚀</strong></p>
        </div>
    </div>

    <script>
        // 목차 링크 스크롤 애니메이션
        document.querySelectorAll('.toc a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>
